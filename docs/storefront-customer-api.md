# Storefront โ Customer API (ะดะปั ััะพะฝัะตะฝะด-ัะฐะทัะฐะฑะพััะธะบะฐ)

> **Base URL:** `http://localhost:3000` (dev) / `https://api.example.com` (prod)
>
> ะัะต ัะตะปะฐ ะทะฐะฟัะพัะพะฒ โ `application/json`. ะัะฒะตัั โ JSON.

---

## ะกะพะดะตัะถะฐะฝะธะต

1. [ะะฑัะธะต ะบะพะฝัะตะฟัะธะธ](#1-ะพะฑัะธะต-ะบะพะฝัะตะฟัะธะธ)
2. [ะะตะณะธัััะฐัะธั](#2-ัะตะณะธัััะฐัะธั)
3. [ะะพะณะธะฝ](#3-ะปะพะณะธะฝ)
4. [ะะฑะฝะพะฒะปะตะฝะธะต ัะพะบะตะฝะพะฒ (Refresh)](#4-ะพะฑะฝะพะฒะปะตะฝะธะต-ัะพะบะตะฝะพะฒ-refresh)
5. [ะะฐะฑัะป ะฟะฐัะพะปั](#5-ะทะฐะฑัะป-ะฟะฐัะพะปั)
6. [ะกะฑัะพั ะฟะฐัะพะปั](#6-ัะฑัะพั-ะฟะฐัะพะปั)
7. [ะัะพัะธะปั ะฟะพะบัะฟะฐัะตะปั](#7-ะฟัะพัะธะปั-ะฟะพะบัะฟะฐัะตะปั)
8. [ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฟัะพัะธะปั](#8-ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต-ะฟัะพัะธะปั)
9. [ะััะพัะธั ะทะฐะบะฐะทะพะฒ (ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะน)](#9-ะธััะพัะธั-ะทะฐะบะฐะทะพะฒ-ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะน)
10. [ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ](#10-ัะพะทะดะฐะฝะธะต-ะทะฐะบะฐะทะฐ)
11. [ะััะพัะธั ะทะฐะบะฐะทะพะฒ (ะณะพััะตะฒะฐั)](#11-ะธััะพัะธั-ะทะฐะบะฐะทะพะฒ-ะณะพััะตะฒะฐั)
12. [ะขะธะฟั ะธ ะธะฝัะตััะตะนัั](#12-ัะธะฟั-ะธ-ะธะฝัะตััะตะนัั)
13. [ะคะปะพั-ะดะธะฐะณัะฐะผะผั](#13-ัะปะพั-ะดะธะฐะณัะฐะผะผั)
14. [ะะพะดั ะพัะธะฑะพะบ](#14-ะบะพะดั-ะพัะธะฑะพะบ)

---

## 1. ะะฑัะธะต ะบะพะฝัะตะฟัะธะธ

### clientId

ะะตะฝะตัะธััะตััั ะฝะฐ ััะพะฝัะต ะฟัะธ ะฟะตัะฒะพะผ ะฒะธะทะธัะต ะธ ััะฐะฝะธััั ะฒ `localStorage`. ะัะฟะพะปัะทัะตััั ะดะปั:
- ะฟัะธะฒัะทะบะธ ะณะพััะตะฒัั ะทะฐะบะฐะทะพะฒ ะบ ัะตััะธะธ
- ะฟัะธ ัะตะณะธัััะฐัะธะธ โ ะฒัะต ะณะพััะตะฒัะต ะทะฐะบะฐะทั ั ััะธะผ `clientId` + `phone` ะฟัะธะบัะตะฟะปััััั ะบ ะฐะบะบะฐัะฝัั

```ts
function getOrCreateClientId(): string {
  let id = localStorage.getItem('clientId');
  if (!id) {
    id = crypto.randomUUID();
    localStorage.setItem('clientId', id);
  }
  return id;
}
```

### ะะฒัะพัะธะทะฐัะธั (Bearer Token)

```
Authorization: Bearer <accessToken>
```

Access-ัะพะบะตะฝ ะถะธะฒัั **15 ะผะธะฝัั**. Refresh-ัะพะบะตะฝ โ **30 ะดะฝะตะน**.

### ะฅัะฐะฝะตะฝะธะต ัะพะบะตะฝะพะฒ

```ts
// ะะพัะปะต ะปะพะณะธะฝะฐ / ัะตะณะธัััะฐัะธะธ
localStorage.setItem('accessToken', tokens.accessToken);
localStorage.setItem('refreshToken', tokens.refreshToken);
```

### Axios interceptor (ัะตะบะพะผะตะฝะดะฐัะธั)

```ts
import axios from 'axios';

const api = axios.create({ baseURL: 'http://localhost:3000' });

// ะะพะฑะฐะฒะปััั ัะพะบะตะฝ ะบ ะทะฐะฟัะพัะฐะผ
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('accessToken');
  if (token) config.headers.Authorization = `Bearer ${token}`;
  return config;
});

// ะะฒัะพ-ะพะฑะฝะพะฒะปะตะฝะธะต ะฟัะธ 401
api.interceptors.response.use(
  (res) => res,
  async (error) => {
    const original = error.config;
    if (error.response?.status === 401 && !original._retry) {
      original._retry = true;
      try {
        const refreshToken = localStorage.getItem('refreshToken');
        if (!refreshToken) throw new Error('No refresh token');
        const { data } = await axios.post('/auth/refresh', { refreshToken });
        localStorage.setItem('accessToken', data.accessToken);
        if (data.refreshToken) localStorage.setItem('refreshToken', data.refreshToken);
        original.headers.Authorization = `Bearer ${data.accessToken}`;
        return api(original);
      } catch {
        // Refresh ะฝะต ัะดะฐะปัั โ ัะฐะทะปะพะณะธะฝะธัั
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        window.location.href = '/login';
      }
    }
    return Promise.reject(error);
  }
);
```

---

## 2. ะะตะณะธัััะฐัะธั

### `POST /auth/register`

| ะะพะปะต | ะขะธะฟ | ะะฑัะทะฐัะตะปัะฝะพะต | ะะฐะปะธะดะฐัะธั |
|------|-----|:---:|-----------|
| `phone` | `string` | โ | 5โ32 ัะธะผะฒะพะปะฐ, ัะพัะผะฐั ัะตะปะตัะพะฝะฐ (E.164 ะธะปะธ ะปะพะบะฐะปัะฝัะน) |
| `email` | `string` | โ | ะะฐะปะธะดะฝัะน email |
| `password` | `string` | โ | 6โ128 ัะธะผะฒะพะปะพะฒ |
| `clientId` | `string` | โ | 1โ64 ัะธะผะฒะพะปะฐ (ะธะท `localStorage`) |
| `name` | `string` | โ | ะะฐะบั. 120 ัะธะผะฒะพะปะพะฒ |
| `marketingOptIn` | `boolean` | โ | ะกะพะณะปะฐัะธะต ะฝะฐ ัะฐัััะปะบั |

**ะะฐะฟัะพั:**
```json
{
  "phone": "+380971112233",
  "email": "ivan@example.com",
  "password": "mypassword123",
  "clientId": "550e8400-e29b-41d4-a716-446655440000",
  "name": "ะะฒะฐะฝ",
  "marketingOptIn": true
}
```

**ะัะฒะตั `201`:**
```json
{
  "customer": {
    "id": "65f1a2b3c4d5e6f7a8b9c001",
    "phone": "+380971112233",
    "email": "ivan@example.com",
    "name": "ะะฒะฐะฝ",
    "isPhoneVerified": false,
    "createdAt": "2026-02-19T12:00:00.000Z",
    "updatedAt": "2026-02-19T12:00:00.000Z",
    "lastLoginAt": "2026-02-19T12:00:00.000Z"
  },
  "tokens": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "accessTokenExpiresInSec": 900,
    "tokenType": "bearer",
    "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshTokenExpiresInSec": 2592000
  }
}
```

**ะัะธะฑะบะธ:**

| ะะพะด | ะะพะณะดะฐ |
|-----|-------|
| `400` | ะะฐะปะธะดะฐัะธั ะฝะต ะฟัะพะนะดะตะฝะฐ (ะฝะตะฒะฐะปะธะดะฝัะน email, ะบะพัะพัะบะธะน ะฟะฐัะพะปั ะธ ั.ะด.) |
| `409` | Email ัะถะต ะทะฐะฝัั / ะขะตะปะตัะพะฝ ัะถะต ะทะฐัะตะณะธัััะธัะพะฒะฐะฝ |

> **ะะฐะถะฝะพ:** ะฟัะธ ัะตะณะธัััะฐัะธะธ ะฒัะต ะณะพััะตะฒัะต ะทะฐะบะฐะทั ั ัะพะฒะฟะฐะดะฐััะธะผ `phone` + `clientId` ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธะฒัะทัะฒะฐัััั ะบ ะฐะบะบะฐัะฝัั.

---

## 3. ะะพะณะธะฝ

### `POST /auth/login`

| ะะพะปะต | ะขะธะฟ | ะะฑัะทะฐัะตะปัะฝะพะต | ะะฟะธัะฐะฝะธะต |
|------|-----|:---:|----------|
| `login` | `string` | โ | Email **ะธะปะธ** ัะตะปะตัะพะฝ (3โ120 ัะธะผะฒะพะปะพะฒ) |
| `password` | `string` | โ | 6โ128 ัะธะผะฒะพะปะพะฒ |
| `clientId` | `string` | โ | 1โ64 ัะธะผะฒะพะปะฐ |

**ะะฐะฟัะพั:**
```json
{
  "login": "ivan@example.com",
  "password": "mypassword123",
  "clientId": "550e8400-e29b-41d4-a716-446655440000"
}
```

ะะปะธ ะฟะพ ัะตะปะตัะพะฝั:
```json
{
  "login": "+380971112233",
  "password": "mypassword123",
  "clientId": "550e8400-e29b-41d4-a716-446655440000"
}
```

**ะัะฒะตั `201`:**
```json
{
  "customer": {
    "id": "65f1a2b3c4d5e6f7a8b9c001",
    "phone": "+380971112233",
    "email": "ivan@example.com",
    "name": "ะะฒะฐะฝ",
    "isPhoneVerified": false,
    "createdAt": "2026-02-19T12:00:00.000Z",
    "updatedAt": "2026-02-19T12:00:00.000Z",
    "lastLoginAt": "2026-02-19T12:05:00.000Z"
  },
  "tokens": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "accessTokenExpiresInSec": 900,
    "tokenType": "bearer",
    "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshTokenExpiresInSec": 2592000
  }
}
```

**ะัะธะฑะบะธ:**

| ะะพะด | ะะพะณะดะฐ |
|-----|-------|
| `400` | ะะฐะปะธะดะฐัะธั ะฝะต ะฟัะพะนะดะตะฝะฐ |
| `401` | ยซะะตะฒััะฝะธะน ะปะพะณัะฝ ะฐะฑะพ ะฟะฐัะพะปัยป (ะพะดะธะฝะฐะบะพะฒะพะต ัะพะพะฑัะตะฝะธะต ะดะปั ะฝะตัััะตััะฒัััะตะณะพ ะปะพะณะธะฝะฐ ะธ ะฝะตะฟัะฐะฒะธะปัะฝะพะณะพ ะฟะฐัะพะปั โ ะทะฐัะธัะฐ ะพั ะฟะตัะตะฑะพัะฐ) |

---

## 4. ะะฑะฝะพะฒะปะตะฝะธะต ัะพะบะตะฝะพะฒ (Refresh)

### `POST /auth/refresh`

ะัะทัะฒะฐัั ะบะพะณะดะฐ `accessToken` ะธัััะบ (401 ะพั API) ะธะปะธ **ะฟัะพะฐะบัะธะฒะฝะพ** ะทะฐ ~30 ัะตะบ ะดะพ ะธััะตัะตะฝะธั.

| ะะพะปะต | ะขะธะฟ | ะะฑัะทะฐัะตะปัะฝะพะต |
|------|-----|:---:|
| `refreshToken` | `string` | โ |

**ะะฐะฟัะพั:**
```json
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
}
```

**ะัะฒะตั `201`:**
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIs...",
  "accessTokenExpiresInSec": 900,
  "tokenType": "bearer",
  "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
  "refreshTokenExpiresInSec": 2592000
}
```

**ะัะธะฑะบะธ:**

| ะะพะด | ะะพะณะดะฐ |
|-----|-------|
| `401` | Refresh-ัะพะบะตะฝ ะฝะตะฒะฐะปะธะดะฝัะน ะธะปะธ ะฟัะพััะพัะตะฝะฝัะน โ **ัะฐะทะปะพะณะธะฝะธัั ะฟะพะปัะทะพะฒะฐัะตะปั** |

> **ะะฐะถะฝะพ:** ะฟัะธ ััะฟะตัะฝะพะผ refresh ะฟัะธัะพะดัั **ะฝะพะฒัะต** access + refresh ัะพะบะตะฝั. ะกะพััะฐะฝัะนัะต ะพะฑะฐ. ะกัะฐััะน refresh-ัะพะบะตะฝ ะพะดะฝะพัะฐะทะพะฒัะน ะฟะพ ััะพะบั.

---

## 5. ะะฐะฑัะป ะฟะฐัะพะปั

### `POST /auth/forgot-password`

| ะะพะปะต | ะขะธะฟ | ะะฑัะทะฐัะตะปัะฝะพะต |
|------|-----|:---:|
| `email` | `string` | โ |

**ะะฐะฟัะพั:**
```json
{
  "email": "ivan@example.com"
}
```

**ะัะฒะตั `201` (ะฒัะตะณะดะฐ ะพะดะธะฝะฐะบะพะฒัะน, ะทะฐัะธัะฐ ะพั ะฟะตัะตะฑะพัะฐ):**
```json
{
  "message": "ะฏะบัะพ email ััะฝัั, ะปะธัั ะท ัะฝััััะบัััะผะธ ะฑัะดะต ะฝะฐะดััะปะฐะฝะพ"
}
```

ะะฐ ะฟะพััั ะฟัะธัะพะดะธั ะฟะธััะผะพ ัะพ ัััะปะบะพะน ะฒะธะดะฐ:
```
http://localhost:5173/reset-password?token=eyJhbGciOiJIUzI1NiIs...
```

> ะคัะพะฝั ะดะพะปะถะตะฝ ะพะฑัะฐะฑะพัะฐัั ะผะฐััััั `/reset-password` ะธ ะธะทะฒะปะตัั `token` ะธะท query-ะฟะฐัะฐะผะตััะฐ.

---

## 6. ะกะฑัะพั ะฟะฐัะพะปั

### `POST /auth/reset-password`

| ะะพะปะต | ะขะธะฟ | ะะฑัะทะฐัะตะปัะฝะพะต | ะะฟะธัะฐะฝะธะต |
|------|-----|:---:|----------|
| `token` | `string` | โ | JWT-ัะพะบะตะฝ ะธะท ัััะปะบะธ ะฒ ะฟะธััะผะต |
| `newPassword` | `string` | โ | 6โ128 ัะธะผะฒะพะปะพะฒ |

**ะะฐะฟัะพั:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "newPassword": "newStrongPassword456"
}
```

**ะัะฒะตั `201`:**
```json
{
  "message": "ะะฐัะพะปั ััะฟััะฝะพ ะทะผัะฝะตะฝะพ"
}
```

**ะัะธะฑะบะธ:**

| ะะพะด | ะะพะณะดะฐ |
|-----|-------|
| `400` | ะขะพะบะตะฝ ะฝะตะฒะฐะปะธะดะฝัะน, ะฟัะพััะพัะตะฝะฝัะน ะธะปะธ ัะถะต ะธัะฟะพะปัะทะพะฒะฐะฝะฝัะน |
| `404` | ะะพะบัะฟะฐัะตะปั ะฝะต ะฝะฐะนะดะตะฝ |

> **ะขะพะบะตะฝ ะพะดะฝะพัะฐะทะพะฒัะน:** ะตัะปะธ ะฟะฐัะพะปั ัะถะต ะฑัะป ัะฑัะพัะตะฝ, ัะพะบะตะฝ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธะฝะฒะฐะปะธะดะธััะตััั (ะฟัะพะฒะตัะบะฐ ะฟะพ ะพัะฟะตัะฐัะบั ัะตัะฐ ะฟะฐัะพะปั).

---

## 7. ะัะพัะธะปั ะฟะพะบัะฟะฐัะตะปั

### `GET /me`

๐ **ะขัะตะฑัะตั `Authorization: Bearer <accessToken>`**

**ะัะฒะตั `200`:**
```json
{
  "id": "65f1a2b3c4d5e6f7a8b9c001",
  "phone": "+380971112233",
  "email": "ivan@example.com",
  "name": "ะะฒะฐะฝ",
  "isPhoneVerified": false,
  "createdAt": "2026-02-19T12:00:00.000Z",
  "updatedAt": "2026-02-19T12:00:00.000Z",
  "lastLoginAt": "2026-02-19T12:05:00.000Z"
}
```

**ะัะธะฑะบะธ:**

| ะะพะด | ะะพะณะดะฐ |
|-----|-------|
| `401` | ะขะพะบะตะฝ ะพััััััะฒัะตั, ะฝะตะฒะฐะปะธะดะฝัะน ะธะปะธ ะฟัะพััะพัะตะฝะฝัะน |

---

## 8. ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฟัะพัะธะปั

### `PATCH /me`

๐ **ะขัะตะฑัะตั `Authorization: Bearer <accessToken>`**

| ะะพะปะต | ะขะธะฟ | ะะฑัะทะฐัะตะปัะฝะพะต | ะะฐะปะธะดะฐัะธั |
|------|-----|:---:|-----------|
| `name` | `string` | โ | ะะฐะบั. 120 ัะธะผะฒะพะปะพะฒ |
| `email` | `string` | โ | ะะฐะปะธะดะฝัะน email |

**ะะฐะฟัะพั (ะพัะฟัะฐะฒะปััั ัะพะปัะบะพ ะธะทะผะตะฝะธะฒัะธะตัั ะฟะพะปั):**
```json
{
  "name": "ะะฒะฐะฝ ะะตััะพะฒะธั",
  "email": "newemail@example.com"
}
```

**ะัะฒะตั `200`:** ะะฑะฝะพะฒะปัะฝะฝัะน ะพะฑัะตะบั `Customer` (ะฐะฝะฐะปะพะณะธัะฝะพ `GET /me`).

**ะัะธะฑะบะธ:**

| ะะพะด | ะะพะณะดะฐ |
|-----|-------|
| `401` | ะะต ะฐะฒัะพัะธะทะพะฒะฐะฝ |
| `409` | Email ัะถะต ะทะฐะฝัั ะดััะณะธะผ ะฟะพะปัะทะพะฒะฐัะตะปะตะผ |

---

## 9. ะััะพัะธั ะทะฐะบะฐะทะพะฒ (ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะน)

### `GET /me/orders`

๐ **ะขัะตะฑัะตั `Authorization: Bearer <accessToken>`**

| ะะฐัะฐะผะตัั | ะขะธะฟ | ะะพ ัะผะพะปัะฐะฝะธั | ะะฟะธัะฐะฝะธะต |
|----------|-----|:---:|----------|
| `page` | `number` | `1` | ะะพะผะตั ัััะฐะฝะธัั |
| `limit` | `number` | `20` | ะญะปะตะผะตะฝัะพะฒ ะฝะฐ ัััะฐะฝะธัะต (1โ100) |

**ะะฐะฟัะพั:**
```
GET /me/orders?page=1&limit=10
```

**ะัะฒะตั `200`:**
```json
{
  "items": [
    {
      "_id": "666600000000000000000001",
      "phone": "+380971112233",
      "clientId": "550e8400-...",
      "customerId": "65f1a2b3c4d5e6f7a8b9c001",
      "items": [
        {
          "productId": "665f1a2b3c4d5e6f7a8b9c0d",
          "sku": "UC-1",
          "quantity": 2,
          "price": 350,
          "priceOriginal": 400,
          "title": "ะะพะผะฟะพะทะธั ัะฝัะฒะตััะฐะปัะฝะธะน",
          "options": { "shade": "A2" },
          "unit": "ัั",
          "discountsApplied": [
            {
              "discountId": "disc001",
              "name": "ะะฝะธะถะบะฐ 10%",
              "type": "percent",
              "value": 10,
              "priceBefore": 400,
              "priceAfter": 350
            }
          ]
        }
      ],
      "itemsTotal": 700,
      "deliveryFee": 0,
      "total": 700,
      "status": "new",
      "name": "ะะฒะฐะฝ",
      "comment": "ะะฐัะตะปะตัะพะฝัะนัะต ะฟะตัะตะด ะดะพััะฐะฒะบะพั",
      "createdAt": "2026-02-19T12:00:00.000Z",
      "updatedAt": "2026-02-19T12:00:00.000Z"
    }
  ],
  "page": 1,
  "limit": 10,
  "total": 1
}
```

> ะะพะทะฒัะฐัะฐะตั **ะฒัะต ะทะฐะบะฐะทั ะฟะพะปัะทะพะฒะฐัะตะปั** (ะธ ะณะพััะตะฒัะต, ะฟัะธะฒัะทะฐะฝะฝัะต ะฟัะธ ัะตะณะธัััะฐัะธะธ, ะธ ะฝะพะฒัะต).

---

## 10. ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ

### `POST /orders`

๐ **ะะฒัะพัะธะทะฐัะธั ะพะฟัะธะพะฝะฐะปัะฝะฐ** โ ะตัะปะธ ะฟะตัะตะดะฐะฝ `Bearer`, ะทะฐะบะฐะท ะฟัะธะฒัะถะตััั ะบ ะฐะบะบะฐัะฝัั.

| ะะพะปะต | ะขะธะฟ | ะะฑัะทะฐัะตะปัะฝะพะต | ะะฟะธัะฐะฝะธะต |
|------|-----|:---:|----------|
| `phone` | `string` | โ | ะขะตะปะตัะพะฝ ะฟะพะบัะฟะฐัะตะปั |
| `clientId` | `string` | โ | ID ัะตััะธะธ ะธะท `localStorage` |
| `items` | `array` | โ | ะะธะฝะธะผัะผ 1 ัะปะตะผะตะฝั |
| `items[].productId` | `string` | โ | ID ัะพะฒะฐัะฐ |
| `items[].sku` | `string` | โ | ะััะธะบัะป |
| `items[].quantity` | `number` | โ | ะะพะปะธัะตััะฒะพ (โฅ 1) |
| `items[].price` | `number` | โ | ะฆะตะฝะฐ ะทะฐ ะตะดะธะฝะธัั |
| `items[].title` | `string` | โ | ะะฐะทะฒะฐะฝะธะต (ัะฝัะฟัะพั) |
| `items[].options` | `object` | โ | ะะฐัะธะฐะฝัั `{ shade: "A2" }` |
| `items[].manufacturerId` | `string` | โ | ID ะฟัะพะธะทะฒะพะดะธัะตะปั |
| `items[].countryId` | `string` | โ | ID ัััะฐะฝั |
| `items[].unit` | `string` | โ | ะะดะธะฝะธัะฐ ะธะทะผะตัะตะฝะธั |
| `deliveryFee` | `number` | โ | ะกัะพะธะผะพััั ะดะพััะฐะฒะบะธ |
| `name` | `string` | โ | ะะผั ะฟะพะบัะฟะฐัะตะปั (ะผะฐะบั. 120) |
| `comment` | `string` | โ | ะะพะผะผะตะฝัะฐัะธะน (ะผะฐะบั. 500) |

**ะะฐะณะพะปะพะฒะบะธ:**
```
Authorization: Bearer <accessToken>        โ ะพะฟัะธะพะฝะฐะปัะฝะพ
X-Idempotency-Key: <unique-string>         โ ัะตะบะพะผะตะฝะดัะตััั (ะทะฐัะธัะฐ ะพั ะดัะฑะปะตะน)
```

**ะะฐะฟัะพั:**
```json
{
  "phone": "+380971112233",
  "clientId": "550e8400-e29b-41d4-a716-446655440000",
  "items": [
    {
      "productId": "665f1a2b3c4d5e6f7a8b9c0d",
      "sku": "UC-1",
      "quantity": 2,
      "price": 350,
      "title": "ะะพะผะฟะพะทะธั ัะฝัะฒะตััะฐะปัะฝะธะน",
      "options": { "shade": "A2" }
    }
  ],
  "name": "ะะฒะฐะฝ",
  "comment": "ะะฐัะตะปะตัะพะฝัะนัะต ะฟะตัะตะด ะดะพััะฐะฒะบะพั"
}
```

**ะัะฒะตั `201`:** ะกะพะทะดะฐะฝะฝัะน ะทะฐะบะฐะท (ะฟะพะปะฝัะน ะพะฑัะตะบั ะฐะฝะฐะปะพะณะธัะฝะพ `/me/orders`).

> **ะะดะตะผะฟะพัะตะฝัะฝะพััั:** ะตัะปะธ ะฟะตัะตะดะฐัั `X-Idempotency-Key`, ะฟะพะฒัะพัะฝัะน ะทะฐะฟัะพั ั ัะตะผ ะถะต ะบะปััะพะผ ะฒะตัะฝัั ัะพั ะถะต ะทะฐะบะฐะท ะฑะตะท ัะพะทะดะฐะฝะธั ะดัะฑะปะธะบะฐัะฐ.

---

## 11. ะััะพัะธั ะทะฐะบะฐะทะพะฒ (ะณะพััะตะฒะฐั)

### `GET /orders/history`

ะะปั **ะฝะตะฐะฒัะพัะธะทะพะฒะฐะฝะฝัั** ะฟะพะปัะทะพะฒะฐัะตะปะตะน โ ะฟะพะธัะบ ะทะฐะบะฐะทะพะฒ ะฟะพ ัะตะปะตัะพะฝั + clientId.

| ะะฐัะฐะผะตัั | ะขะธะฟ | ะะฑัะทะฐัะตะปัะฝะพะต |
|----------|-----|:---:|
| `phone` | `string` | โ |
| `clientId` | `string` | โ |

**ะะฐะฟัะพั:**
```
GET /orders/history?phone=%2B380971112233&clientId=550e8400-e29b-41d4-a716-446655440000
```

**ะัะฒะตั `200`:** ะะฐััะธะฒ ะทะฐะบะฐะทะพะฒ.

> ะะพัะปะต ัะตะณะธัััะฐัะธะธ ัะตะบะพะผะตะฝะดัะตััั ะฟะตัะตะบะปััะธัััั ะฝะฐ `GET /me/orders`.

---

## 12. ะขะธะฟั ะธ ะธะฝัะตััะตะนัั

### Customer

```ts
interface Customer {
  id: string;
  phone: string;            // E.164: "+380971112233"
  email: string | null;
  name: string | null;
  isPhoneVerified: boolean;
  createdAt: string | null;  // ISO 8601
  updatedAt: string | null;
  lastLoginAt: string | null;
}
```

### AuthTokens

```ts
interface AuthTokens {
  accessToken: string;
  accessTokenExpiresInSec: number;   // 900 (15 ะผะธะฝ)
  tokenType: 'bearer';
  refreshToken?: string;
  refreshTokenExpiresInSec?: number; // 2592000 (30 ะดะฝะตะน)
}
```

### RegisterResult / LoginResult

```ts
interface AuthResult {
  customer: Customer;
  tokens: AuthTokens;
}
```

### Order

```ts
interface Order {
  _id: string;
  phone: string;
  clientId: string;
  customerId?: string;       // ะฟัะธัััััะฒัะตั ะตัะปะธ ะทะฐะบะฐะท ะพั ะฐะฒัะพัะธะทะพะฒะฐะฝะฝะพะณะพ
  items: OrderItem[];
  itemsTotal: number;
  deliveryFee: number;
  total: number;
  status: 'new' | 'processing' | 'done' | 'cancelled';
  name?: string;
  comment?: string;
  createdAt: string;
  updatedAt: string;
}
```

### OrderItem

```ts
interface OrderItem {
  productId: string;
  sku: string;
  quantity: number;
  price: number;              // ัะธะฝะฐะปัะฝะฐั ัะตะฝะฐ (ะฟะพัะปะต ัะบะธะดะพะบ)
  priceOriginal?: number;     // ะพัะธะณะธะฝะฐะปัะฝะฐั ัะตะฝะฐ (ะดะพ ัะบะธะดะพะบ)
  title: string;
  options: Record<string, string | number>;
  manufacturerId?: string;
  countryId?: string;
  unit?: string;
  discountsApplied?: Array<{
    discountId: string;
    name: string;
    type: 'percent' | 'fixed';
    value: number;
    priceBefore: number;
    priceAfter: number;
  }>;
}
```

### OrdersPage (ะฟะฐะณะธะฝะฐัะธั)

```ts
interface OrdersPage {
  items: Order[];
  page: number;
  limit: number;
  total: number;
}
```

---

## 13. ะคะปะพั-ะดะธะฐะณัะฐะผะผั

### ะะตะณะธัััะฐัะธั + ะฟะตัะฒัะน ะทะฐะบะฐะท

```
โโโโโโโโโโโโโโโ
โ  ะะพััั ะฝะฐ   โ
โ  ัะฐะนัะต      โ
โโโโโโโโฌโโโโโโโ
       โ ะณะตะฝะตัะธััะตั clientId (UUID โ localStorage)
       โ ะดะตะปะฐะตั ะทะฐะบะฐะทั ะบะฐะบ ะณะพััั (POST /orders ั phone + clientId)
       โผ
โโโโโโโโโโโโโโโ
โ  ะะตะณะธัััะฐัะธัโ  POST /auth/register { phone, email, password, clientId }
โโโโโโโโฌโโโโโโโ
       โ โ ะฟะพะปััะฐะตั { customer, tokens }
       โ โ ะณะพััะตะฒัะต ะทะฐะบะฐะทั (phone + clientId) ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธะฒัะทะฐะฝั
       โ
       โ localStorage.setItem('accessToken', tokens.accessToken)
       โ localStorage.setItem('refreshToken', tokens.refreshToken)
       โผ
โโโโโโโโโโโโโโโ
โ  ะะฒัะพัะธะทะพะฒะฐะฝ โ  ะัะต ะทะฐะฟัะพัั ั Bearer token
โ  ะฟะพะบัะฟะฐัะตะปั  โ  GET /me, GET /me/orders, PATCH /me
โโโโโโโโฌโโโโโโโ
       โ POST /orders (ั Bearer โ ะทะฐะบะฐะท ั customerId)
       โผ
```

### ะะพะณะธะฝ โ Refresh โ Logout

```
โโโโโโโโโโโโ     POST /auth/login
โ  ะะพะณะธะฝ   โโโโโโโโโโโโโโโโโโโโโโโโโบ tokens { accessToken, refreshToken }
โโโโโโโโโโโโ                         โ
                                     โ ัะพััะฐะฝะธัั ะพะฑะฐ ะฒ localStorage
                                     โผ
โโโโโโโโโโโโโโโโ   Authorization: Bearer <accessToken>
โ  ะะฐะฑะพัะฐ      โโโโโโโโโโโโโโโโโโโโโโ GET /me, GET /me/orders ...
โ  ั ะบะฐะฑะธะฝะตัะพะผ โ
โโโโโโโโฌโโโโโโโโ
       โ accessToken ะธัััะบ (401)
       โผ
โโโโโโโโโโโโ     POST /auth/refresh { refreshToken }
โ Refresh  โโโโโโโโโโโโโโโโโโโโโโโโโบ ะฝะพะฒัะต tokens
โโโโโโโโฌโโโโ                         โ
       โ                             โ ะพะฑะฝะพะฒะธัั ะพะฑะฐ ะฒ localStorage
       โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ refreshToken ัะพะถะต ะฝะต ะฒะฐะปะธะดะตะฝ (401)
       โผ
โโโโโโโโโโโโ
โ  Logout  โ  ะพัะธััะธัั localStorage, ัะตะดะธัะตะบั ะฝะฐ /login
โโโโโโโโโโโโ
```

### ะกะฑัะพั ะฟะฐัะพะปั

```
โโโโโโโโโโโโโโโโ
โ ะะฐะฑัะป ะฟะฐัะพะปั โ  POST /auth/forgot-password { email }
โโโโโโโโฌโโโโโโโโ  โ ะฒัะตะณะดะฐ 200 (ะทะฐัะธัะฐ ะพั ะฟะตัะตะฑะพัะฐ)
       โ
       โ ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะพะปััะฐะตั email ัะพ ัััะปะบะพะน:
       โ https://site.com/reset-password?token=eyJ...
       โผ
โโโโโโโโโโโโโโโโ
โ ะคะพัะผะฐ ัะฑัะพัะฐ โ  ะคัะพะฝั: ัััะฐะฝะธัะฐ /reset-password
โ              โ  ะธะทะฒะปะตะบะฐะตั token ะธะท URL query
โโโโโโโโฌโโโโโโโโ
       โ POST /auth/reset-password { token, newPassword }
       โผ
โโโโโโโโโโโโโโโโ
โ ะะฐัะพะปั       โ  โ "ะะฐัะพะปั ััะฟััะฝะพ ะทะผัะฝะตะฝะพ"
โ ะธะทะผะตะฝัะฝ      โ  โ ัะตะดะธัะตะบั ะฝะฐ /login
โโโโโโโโโโโโโโโโ
```

---

## 14. ะะพะดั ะพัะธะฑะพะบ

| HTTP | ะะฝะฐัะตะฝะธะต | ะงัะพ ะดะตะปะฐัั |
|------|----------|------------|
| `400` | ะะฐะปะธะดะฐัะธั ะฝะต ะฟัะพะนะดะตะฝะฐ | ะะพะบะฐะทะฐัั ะพัะธะฑะบะธ ะฟะพะปะตะน ะธะท `message` (ะผะฐััะธะฒ ัััะพะบ) |
| `401` | ะะต ะฐะฒัะพัะธะทะพะฒะฐะฝ / ัะพะบะตะฝ ะฟัะพััะพัะตะฝ | ะะพะฟัะพะฑะพะฒะฐัั refresh. ะัะปะธ refresh ัะพะถะต 401 โ logout |
| `404` | ะะตัััั ะฝะต ะฝะฐะนะดะตะฝ | ะะพะบะฐะทะฐัั ยซะฝะต ะฝะฐะนะดะตะฝะพยป |
| `409` | ะะพะฝัะปะธะบั (email/ัะตะปะตัะพะฝ ะทะฐะฝัั) | ะะพะบะฐะทะฐัั ัะพะพะฑัะตะฝะธะต ะธะท `message` |
| `429` | ะกะปะธัะบะพะผ ะผะฝะพะณะพ ะทะฐะฟัะพัะพะฒ | ะะพะบะฐะทะฐัั ยซะฟะพะฟัะพะฑัะนัะต ะฟะพะทะถะตยป |

### ะคะพัะผะฐั ะพัะธะฑะบะธ

```json
{
  "statusCode": 409,
  "message": "Email ะฒะถะต ะทะฐะนะฝััะธะน",
  "error": "Conflict"
}
```

ะัะธ ะพัะธะฑะบะฐั ะฒะฐะปะธะดะฐัะธะธ `message` ะผะพะถะตั ะฑััั ะผะฐััะธะฒะพะผ:
```json
{
  "statusCode": 400,
  "message": [
    "email must be an email",
    "password must be longer than or equal to 6 characters"
  ],
  "error": "Bad Request"
}
```

---

## ะะฐัะฐะปะพะณ (ัะฟัะฐะฒะพัะฝะพ)

ะญัะธ ัะฝะดะฟะพะธะฝัั **ะฝะต ััะตะฑััั ะฐะฒัะพัะธะทะฐัะธะธ** ะธ ะฝัะถะฝั ะดะปั ะพัะพะฑัะฐะถะตะฝะธั ัะพะฒะฐัะพะฒ:

| ะะตัะพะด | ะััั | ะะฟะธัะฐะฝะธะต |
|-------|------|----------|
| `GET` | `/products` | ะกะฟะธัะพะบ ัะพะฒะฐัะพะฒ (ัะธะปัััั: `q`, `category`, `manufacturerId[]`, `countryId[]`, `priceFrom`, `priceTo`, `tags[]`, `sort`, `page`, `limit`) |
| `GET` | `/products/:idOrSlug` | ะะดะธะฝ ัะพะฒะฐั ะฟะพ ID ะธะปะธ slug |
| `GET` | `/categories` | ะัะต ะฐะบัะธะฒะฝัะต ะบะฐัะตะณะพัะธะธ |
| `GET` | `/manufacturers` | ะัะต ะฐะบัะธะฒะฝัะต ะฟัะพะธะทะฒะพะดะธัะตะปะธ |
| `GET` | `/countries` | ะัะต ะฐะบัะธะฒะฝัะต ัััะฐะฝั |

---

## ะกััะฐะฝะธัั ะดะปั ัะตะฐะปะธะทะฐัะธะธ

| ะกััะฐะฝะธัะฐ | ะะฐััััั | ะะพะผะฟะพะฝะตะฝัั |
|----------|---------|------------|
| ะะตะณะธัััะฐัะธั | `/register` | ะคะพัะผะฐ: phone, email, password, name, marketingOptIn |
| ะะพะณะธะฝ | `/login` | ะคะพัะผะฐ: login (email/phone), password |
| ะะฐะฑัะป ะฟะฐัะพะปั | `/forgot-password` | ะคะพัะผะฐ: email |
| ะกะฑัะพั ะฟะฐัะพะปั | `/reset-password?token=...` | ะคะพัะผะฐ: newPassword (+ confirm) |
| ะะธัะฝัะน ะบะฐะฑะธะฝะตั | `/profile` | ะะฐะฝะฝัะต ะธะท GET /me, ะบะฝะพะฟะบะฐ ัะตะดะฐะบัะธัะพะฒะฐะฝะธั |
| ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต | `/profile/edit` | ะคะพัะผะฐ: name, email |
| ะะพะธ ะทะฐะบะฐะทั | `/profile/orders` | ะขะฐะฑะปะธัะฐ ะธะท GET /me/orders ั ะฟะฐะณะธะฝะฐัะธะตะน |
| ะะตัะฐะปะธ ะทะฐะบะฐะทะฐ | `/profile/orders/:id` | ะะฐััะพัะบะฐ ะทะฐะบะฐะทะฐ (ะธะท ะผะฐััะธะฒะฐ items ะฒ /me/orders) |
